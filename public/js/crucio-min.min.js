angular.module("adminModule",[]).controller("adminCtrl",function(e,t,s,n,r){t.set_title_and_nav("Verwaltung | Crucio","Admin"),e.user=angular.fromJson(sessionStorage.user),e.user_search={semester:"",group:"",login:"",query:"",query_keys:["group_name","username"]},e.comment_search={question_id:"",username:"",query:"",query_keys:["question","comment","username","question_id"]},e.update_activity=!1,e.show_activity={search_query:!1,result:!1,login:!1,register:!1,comment:!1,exam_new:!1,exam_update:!1},e.$watch("comment_search",function(t,s){e.questions_by_comment_display=[],e.questions_by_comment.forEach(function(s){for(var r=0;r<s.length;r++){var i=s[r];if(n.is_element_included(i,t)){for(var o=-1,u=0;u<e.questions_by_comment_display.length;u++)if(e.questions_by_comment_display[u][0].question==i.question){o=u;break}o>-1?e.questions_by_comment_display[o].push(i):e.questions_by_comment_display.push([i])}}}),e.questions_by_comment_display.sort(function(e,t){return t[0].date-e[0].date})},!0),s.get("api/v1/users").success(function(t){e.users=t.users,e.distinct_semesters=n.find_distinct(e.users,"semester"),e.distinct_semesters.sort(function(e,t){return e-t}),e.distinct_groups=["Standard","Admin","Autor"],e.ready=1}),s.get("api/v1/comments").success(function(t){e.comments=t.comments,e.distinct_questions=n.find_distinct(e.comments,"question_id"),e.distinct_users=n.find_distinct(e.comments,"username"),e.questions_by_comment=[],e.comments.forEach(function(t){for(var s=-1,n=0;n<e.questions_by_comment.length;n++)if(e.questions_by_comment[n][0].question==t.question){s=n;break}s>-1?e.questions_by_comment[s].push(t):e.questions_by_comment.push([t])}),e.questions_by_comment_display=e.questions_by_comment}),s.get("api/v1/whitelist").success(function(t){e.whitelist=t.whitelist}),s.get("api/v1/stats/general").success(function(t){e.stats=t.stats}),e.add_mail=function(){var t=e.new_whitelist_mail;if(t.length){e.whitelist.push({username:"",mail_address:t});var n={mail_address:t.replace("@","(@)")};s.post("api/v1/whitelist",n).success(function(e){})}},e.remove_mail=function(t){var n=e.whitelist[t].mail_address;n.length&&(e.whitelist.splice(t,1),s["delete"]("api/v1/whitelist/"+n).success(function(e){}))},e.send_mail=function(){var e="";$("#user-table tbody tr:visible").children("td").children("a").each(function(t,s){e+=$(s).attr("data-original-title")+","}),e=e.slice(0,-1),window.location.href="mailto:"+e},e.change_group=function(t){var n=e.users[t].user_id,r=e.users[t].group_id;if(1==n)return!1;2==r?(r=1,e.users[t].group_name="Standard"):3==r?(r=2,e.users[t].group_name="Admin"):(r=3,e.users[t].group_name="Autor");var i={group_id:r};e.users[t].group_id=r,s.put("api/v1/users/"+n+"/group",i).success(function(e){})},e.is_today=function(e){var t=new Date,s=new Date(1e3*e);return t.toDateString()==s.toDateString()?!0:!1},e.is_yesterday=function(e){var t=new Date,s=t-864e5,n=new Date(s),r=new Date(1e3*e);return n.toDateString()==r.toDateString()?!0:!1},e.user_in_selection=function(t){return n.is_element_included(e.users[t],e.user_search)},e.user_in_selection_count=function(){return n.count(e.users,e.user_search)},e.comment_in_selection_count=function(){return n.count(e.comments,e.comment_search)},e.increase_semester=function(){var e={number:"1"};s.post("api/v1/admin/change-semester/dFt(45i$hBmk*I",e).success(function(e){alert(e.status)})},e.decrease_semester=function(){var e={number:"-1"};s.post("api/v1/admin/change-semester/dFt(45i$hBmk*I",e).success(function(e){alert(e.status)})},e.remove_test_account=function(e){s["delete"]("api/v1/users/test-account").success(function(e){alert(e.status)})}}),angular.module("authorModule",[]).controller("authorCtrl",function(e,t,s,n,r){t.set_title_and_nav("Autor | Crucio","Autor"),e.user=angular.fromJson(sessionStorage.user),e.subject_list=subject_list,e.exam_search={subject:"",semester:"",author:e.user.username,query:"",query_keys:["subject","author","date"]},e.comment_search={username_added:"",username:"",query:"",query_keys:["question","comment","username","question_id"]},e.$watch("comment_search",function(t){e.questions_by_comment_display=[],e.questions_by_comment.forEach(function(s){for(var n=0;n<s.length;n++){var i=s[n];if(r.is_element_included(i,t)){for(var o=-1,u=0;u<e.questions_by_comment_display.length;u++)if(e.questions_by_comment_display[u][0].question==i.question){o=u;break}o>-1?e.questions_by_comment_display[o].push(i):e.questions_by_comment_display.push([i])}}}),e.questions_by_comment_display.sort(function(e,t){return t[0].date-e[0].date})},!0),n.get("api/v1/exams/all-visibility").success(function(t){e.exams=t.exams,e.distinct_semesters=[],e.exams.forEach(function(t){-1==e.distinct_semesters.indexOf(t.semester)&&e.distinct_semesters.push(t.semester)}),e.distinct_semesters.sort(),e.distinct_subjects=[],e.exams.forEach(function(t){-1==e.distinct_subjects.indexOf(t.subject)&&e.distinct_subjects.push(t.subject)}),e.distinct_subjects.sort(),e.distinct_authors=[],e.exams.forEach(function(t){-1==e.distinct_authors.indexOf(t.author)&&e.distinct_authors.push(t.author)}),e.distinct_authors.sort(),e.ready=1}),n.get("api/v1/comments/author/"+e.user.user_id).success(function(t){e.comments=t.comments,e.distinct_users=[],e.distinct_users_added=[],e.distinct_users=r.find_distinct(e.comments,"username"),e.distinct_users_added=r.find_distinct(e.comments,"username_added"),e.questions_by_comment=[],e.comments.forEach(function(t){for(var s=-1,n=0;n<e.questions_by_comment.length;n++)if(e.questions_by_comment[n][0].question==t.question){s=n;break}s>0?e.questions_by_comment[s].push(t):e.questions_by_comment.push([t])}),e.questions_by_comment.sort(function(e,t){return t[0].date-e[0].date}),e.questions_by_comment_display=e.questions_by_comment,e.comment_search.username_added=e.user.username}),e.new_exam=function(){var t={subject:"",professor:"",semester:"",date:"",type:"",user_id_added:e.user.user_id,duration:"",notes:""};n.post("api/v1/exams",t).success(function(e,t,n){s.path("/edit-exam").search("id",e.exam_id)})},e.comment_in_selection=function(t){return r.is_element_included(e.comments[t],e.comment_search)},e.comment_in_selection_count=function(){return r.count(e.comments,e.comment_search)},e.exam_in_selection=function(t){return r.is_element_included(e.exams[t],e.exam_search)},e.exam_in_selection_count=function(){return r.count(e.exams,e.exam_search)}}).controller("editCtrl",function(e,t,s,n,r,i){function o(){e.uploader_array=new Array;for(var t=0;t<e.exam.questions.length;t++){{var s=new i({url:"/public/php/upload-file.php",formData:t});e.exam.questions[t]}s.onSuccessItem=function(t,s){var n=t.formData;e.exam.questions[n].question_image_url=s.upload_name},e.uploader_array.push(s)}}function u(){var e=$(this).height()-300+a.height();e>l.height()&&(e=l.height()),c.height(e)}s.set_title_and_nav("Klausur | Crucio","Autor"),e.ready=0,e.user=angular.fromJson(sessionStorage.user),e.exam_id=t.id,e.open_question_id=t.question_id,e.subject_list=subject_list,e.has_changed=0,e.number_changed=0,e.is_saving=0,e.uploader=new i({url:"/public/php/upload-file.php"}),e.uploader.onSuccessItem=function(t,s,n,r){e.exam.file_name=s.upload_name},e.uploader_array=[];{var a=$("#footer"),c=$(".edit-exam-wrapper"),l=$(".edit-exam-wrapper .exam-edit-list-group");e.$watch("exam",function(t,s){e.number_changed>1&&(e.has_changed=1),e.number_changed+=1},!0)}$("body").on("shown.bs.tab",'a[data-toggle="tab"]',function(e){var t=$(this).closest(".list-group").children(".active");t.removeClass("active"),$(e.target).addClass("active")}),e.$on("$locationChangeStart",function(t,s,n){if(1==e.has_changed){var r=confirm("Die Änderungen an deiner Klausur bleiben dann ungespeichert. Wirklich verlassen?");r||t.preventDefault()}}),$(window).on("resize",function(){u()}),r.get("api/v1/exams/"+e.exam_id).success(function(t){e.exam=t,e.exam.semester=parseInt(t.semester),e.exam.duration=parseInt(t.duration);for(var s=0;s<e.exam.questions.length;s++)0==e.exam.questions[s].topic.length&&(e.exam.questions[s].topic="Sonstiges");o(),0==e.exam.questions.length&&e.add_question(0,!1),e.exam.subject||(e.exam.subject="Allgemeine Pathologie",e.exam.sort="Erstklausur"),e.open_question_id,e.ready=1,setTimeout(function(){u()},10)}),e.add_question=function(t,s){"undefined"==typeof s&&(s=!0);var n={};if(n.question="",n.type=5,n.correct_answer=0,n.answers=new Array("","","","","",""),n.topic="Sonstiges",e.exam.questions.push(n),e.open_question_id=0,o(),setTimeout(function(){u()},10),s){var r=e.exam.questions.length+1;setTimeout(function(){$(".edit-exam-wrapper a:nth-child("+r+")").tab("show")},10)}},e.delete_question=function(t){var s=e.exam.questions[t].question_id;s&&r["delete"]("api/v1/questions/"+s).success(function(e,t,s){}),e.exam.questions.splice(t,1),o();var n=t+1;setTimeout(function(){$(".edit-exam-wrapper a:nth-child("+n+")").tab("show")},10),0==e.exam.questions.length&&e.add_question(1),setTimeout(function(){u()},10)},e.leave_edit=function(){e.$apply(n.path(e.next_route))},e.save_exam=function(){var t=!0;if(e.exam.subject||(t=!1),e.exam.semester<1&&(t=!1),e.exam.date||(t=!1),t){e.is_saving=1;var s=e.exam;r.put("api/v1/exams/"+e.exam_id,s).success(function(e){}),e.exam.questions.forEach(function(t){var s=!0;if(t.question.length||(s=!1),t.question_id&&(s=!0),s){!t.explanation,t.explanation="",t.question_image_url||(t.question_image_url="");var n={question:t.question,topic:t.topic,type:t.type,answers:t.answers,correct_answer:t.correct_answer,exam_id:e.exam.exam_id,user_id_added:e.user.user_id,explanation:t.explanation,question_image_url:t.question_image_url};t.question_id?r.put("api/v1/questions/"+t.question_id,n).success(function(e){}):r.post("api/v1/questions",n).success(function(e){t.question_id=e.question_id,console.log(e)})}}),e.has_changed=0,e.is_saving=0}else alert("Da fehlen noch allgemeine Infos zur Klausur.")},e.delete_exam=function(){r["delete"]("api/v1/exams/"+e.exam.exam_id).success(function(e){n.url("/author")})}});var base_url=window.location.origin,is_dev=7==base_url.indexOf("dev")?1:0,subject_list={"Anästhesie und Intensivmedizin":[],Biologie:[],Biochemie:["Chemie der Kohlenhydrate","Chemie der Aminosäuren, Peptide und Proteine","Chemie der Fettsäuren und Lipide","Chemie der Nukleotide und Nukleinsäuren","Vitamine und Koenzyme","Enzyme","Ernährung, Verdauung, Resorption","Abbau der Kohlenhydrate","Abbau der Fettsäuren, Ketonkörper","Aminosäurestoffwechsel","Zitratzyklus und Atmungskette","Glykogenstoffwechsel, Glukoneogenese","Biosynthese der Fettsäuren, Lipogenese","Mineral- und Elektrolythaushalt","Subzelluläre Strukturen","Nukleinsäuren, genetische Information, Molekularbiologie","Hormone","Immunchemie","Blut","Leber","Fettgewebe","Niere, Harn","Muskelgewebe, Bewegung","Binde- und Stützgewebe","Nervensystem"],Physik:[],Physiologie:["Allgemeine und Zellphysiologie, Zellerregung","Blut und Immunsystem","Herz","Blutkreislauf","Atmung","Arbeit- und Leistungsphysiologie","Ernährung, Verdauungstrakt, Leber","Energie- und Wärmehaushalt","Wasser- und Elektrolythaushalt, Nierenfunktion","Hormonale Regulationen","Sexualentwicklung und Reproduktionsphysiologie","Funktionsprinzipien des Nervensystems","Muskulatur","Vegetatives Nervensystem","Motorik","Somatoviszerale Sensorik","Visuelles System","Auditorisches System","Chemische Sinne","Integrative Leistungen des Zentralnervensystems"],Chemie:[],"Klinische Chemie":[],Histologie:[],"Gynäkologie":[],"Innere Medizin":[],Chirurgie:[],Pharmakologie:[],"Klinische Pharmakologie":[],Neuroanatomie:[],"Allgemeine Pathologie":[],"Mikrobiologie / Virologie / Immunologie / Hygiene":[],Psychologie:[],Anatomie:[],Allgemeinmedizin:[],Urologie:[],Dermatologie:[],Humangenetik:[],Neurologie:[],"Orthopädie":[],Psychiatrie:[]},crucioApp=angular.module("crucioApp",["ngRoute","ngSanitize","angular-loading-bar","ui.bootstrap","angularFileUpload","textAngular","angles","ipCookie","crucioModule","userModule","learnModule","authorModule","adminModule"]);crucioApp.config(function(e,t){e.when("",{templateUrl:"index.php",controller:"loginCtrl"}).when("/",{templateUrl:"index.php",controller:"loginCtrl"}).when("/forgot-password",{templateUrl:"forgot-password.php",controller:"forgotPasswordCtrl"}).when("/register",{templateUrl:"register.php",controller:"registerCtrl"}).when("/activate-account",{templateUrl:"activate-account.php",controller:"activateCtrl"}).when("/contact",{templateUrl:"contact.php",controller:"contactCtrl"}).when("/about",{templateUrl:"about.php",controller:"aboutCtrl"}).when("/blog",{templateUrl:"blog.php",controller:"blogCtrl"}).when("/stats",{templateUrl:"stats.php",controller:"blogCtrl"}).when("/questions",{templateUrl:"views/questions.html",controller:"questionsCtrl"}).when("/author",{templateUrl:"views/author.html",controller:"authorCtrl"}).when("/admin",{templateUrl:"views/admin.html",controller:"adminCtrl"}).when("/account",{templateUrl:"views/account.html",controller:"accountCtrl"}).when("/settings",{templateUrl:"views/settings.html",controller:"settingsCtrl"}).when("/edit-exam",{templateUrl:"views/edit-exam.html",controller:"editCtrl"}).when("/question",{templateUrl:"views/question.html",controller:"questionCtrl"}).when("/exam",{templateUrl:"views/exam.html",controller:"examCtrl"}).when("/statistics",{templateUrl:"views/statistics.html",controller:"statisticsCtrl"}).when("/exam-pdf",{templateUrl:"exam-pdf.php",controller:"examCtrl"}).when("/exam-solution-pdf",{templateUrl:"exam-solution-pdf.php",controller:"examCtrl"}).when("/analysis",{templateUrl:"views/analysis.html",controller:"analysisCtrl"}).when("/403",{templateUrl:"views/403.html",controller:"errorCtrl"}).when("/404",{templateUrl:"views/404.html",controller:"errorCtrl"}).when("/500",{templateUrl:"views/500.html",controller:"errorCtrl"}).otherwise({redirectTo:"/404"}),t.html5Mode(!0)}),crucioApp.run(function(e,t,s){var n=["/","/contact","/about","/blog","/register","/activate-account","/forgot-password"],r=["/","/register","/forgot-password"],i=["/author","/edit-exam"],o=["/admin"];t.user=angular.fromJson(sessionStorage.user),t.is_dev=is_dev;var u=e("CrucioUserDev");t.user||u&&(t.user=u,sessionStorage.user=angular.toJson(u));var a=function(e){var t=e;return e.indexOf("?")>-1&&(t=e.substr(0,e.indexOf("?"))),n.indexOf(t)>-1?1:0},c=function(e){var t=e;return e.indexOf("?")>-1&&(t=e.substr(0,e.indexOf("?"))),r.indexOf(t)>-1?1:0},l=function(e){var t=e;return e.indexOf("?")>-1&&(t=e.substr(0,e.indexOf("?"))),i.indexOf(t)>-1?1:0},_=function(e){var t=e;return e.indexOf("?")>-1&&(t=e.substr(0,e.indexOf("?"))),o.indexOf(t)>-1?1:0};if(t.user)var m=t.user.group_id?1:0,d=3==t.user.group_id?1:0,g=2==t.user.group_id?1:0;else var m=0,d=0,g=0;!a(s.url())&&!m,c(s.url())&&m&&s.path("/403"),!l(s.url())||d||g||s.path("/403"),_(s.url())&&!g&&s.path("/403")}),crucioApp.factory("Page",function(){var e="Crucio",t="";return{title:function(){return e},setTitle:function(t){e=t},nav:function(){return t},setNav:function(e){t=e},set_title_and_nav:function(s,n){e=s,t=n}}}),crucioApp.service("Selection",function(){this.is_element_included=function(e,t){for(var s in t)if("query"==s){var n="";t.query_keys.forEach(function(t){n+=e[t]+" "});for(var r=t.query.toLowerCase().split(" "),i=0,o=r.length;o>i;++i){var u=r[i];if(n.toLowerCase().indexOf(u)<0&&u)return!1}}else if("group"==s){if(t.group!=e.group_name&&t.group)return!1}else if("query_keys"!=s&&t[s]!=e[s]&&t[s])return!1;return!0},this.count=function(e,t){if(!e)return 0;for(var s=0,n=0;n<e.length;n++)this.is_element_included(e[n],t)&&s++;return s},this.find_distinct=function(e,t){var s=[];return e.forEach(function(e){-1==s.indexOf(e[t])&&s.push(e[t])}),s.sort(),s}}),crucioApp.filter("cut",function(){return function(e,t,s,n){if(!e)return"";if(s=parseInt(s,10),!s)return e;if(e.length<=s)return e;if(e=e.substr(0,s),t){var r=e.lastIndexOf(" ");-1!=r&&(e=e.substr(0,r))}return e+(n||" ?")}}),Array.prototype.getIndexBy=function(e,t){for(var s=0;s<this.length;s++)if(this[s][e]==t)return s},Array.prototype.getArrayByKey=function(e){for(var t=[],s=0;s<this.length;s++)this[s][e]&&t.push(this[s]);return t},angular.module("crucioModule",[]).controller("titleCtrl",function(e,t){e.Page=t}).controller("contactCtrl",function(e,t,s,n,r,i){e.user=angular.fromJson(sessionStorage.user);var o=r.search();e.question_id=o.question_id,e.subject=o.s,"Antwort"==e.subject&&(e.subject="Falsche Antwort"),e.text="",e.user&&(e.name=e.user.username,e.email=e.user.email),e.question_id&&n.get("api/v1/questions/"+e.question_id).success(function(t){e.question=t.question}),e.is_working=0,e.$watch("name",function(t,s){e.error_no_name=0},!0),e.$watch("email",function(t,s){e.error_no_email=0},!0),e.validate_email=function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)?!1:!0},e.send_mail=function(){var t=e.text,s="kontakt@crucio-leipzig.de",r=1;if(e.name||(r=0,e.error_no_name=1),e.validate_email(e.email)&&(r=0,e.error_no_email=1),r)if(e.is_working=1,e.question_id){s+=", "+e.question.email;var i={name:e.name,email:e.email.replace("@","(@)"),text:t,question_id:e.question_id,author:e.question.username,question:e.question.question,exam_id:e.question.exam_id,subject:e.question.subject,date:e.question.date,author_email:e.question.email,mail_subject:e.subject};n.post("api/v1/contact/send-mail-question",i).success(function(t){e.is_working=0,e.open()})}else{var i={name:e.name,email:e.email.replace("@","(@)"),text:t};n.post("api/v1/contact/send-mail",i).success(function(t){e.is_working=0,e.open()})}},e.open=function(){i.open({templateUrl:"myModalContent.html"})}}).controller("aboutCtrl",function(e){e.user=angular.fromJson(sessionStorage.user)}).controller("blogCtrl",function(e){e.user=angular.fromJson(sessionStorage.user)}).controller("errorCtrl",function(e,t){t.set_title_and_nav("Fehler | Crucio",""),e.user=angular.fromJson(sessionStorage.user)}),angular.module("learnModule",[]).controller("questionsCtrl",function(e,t,s,n,r){t.set_title_and_nav("Lernen | Crucio","Lernen"),e.user=angular.fromJson(sessionStorage.user),e.user||window.location.replace(base_url),e.exam_search={subject:"",semester:"",query:"",query_keys:["subject","semester","date"]},e.comment_search={query:"",query_keys:["comment","username","question_id"]},e.tag_search={query:"",query_keys:["tag"]},e.subject_list=subject_list,e.question_field_message="",e.selection_subject_list={},e.selection_number_questions=0,e.number_questions_in_choosen_subjects=0,e.conditions=1;var i=new Spinner({length:0,radius:18,color:"#333",shadow:!1});$("#numberSlider").slider({value:e.selection_number_questions,step:10,min:0,max:e.number_questions_in_choosen_subjects}),e.$watch("selection_subject_list",function(t,s){var r={ignoreLoadingBar:!0,selection_subject_list:e.selection_subject_list};n.post("api/v1/learn/number-questions",r).success(function(t){e.number_questions_in_choosen_subjects=t.number_questions,0==e.selection_number_questions&&(e.selection_number_questions=Math.min(e.number_questions_in_choosen_subjects,50)),e.selection_number_questions>e.number_questions_in_choosen_subjects&&(e.selection_number_questions=e.number_questions_in_choosen_subjects)})},!0),e.$watch("number_questions_in_choosen_subjects",function(t,s){var n=e.number_questions_in_choosen_subjects;n>200&&(n=200);var r=10;100>n&&(r=10),40>n&&(r=4),20>n&&(r=1),200>n&&n%r!=0&&(n+=r),$("#numberSlider").slider({value:e.selection_number_questions,step:r,min:0,max:n})},!0),n.get("api/v1/exams/user_id/"+e.user.user_id).success(function(t){e.exams=t.exam,e.distinct_semesters=r.find_distinct(e.exams,"semester"),e.distinct_subjects=r.find_distinct(e.exams,"subject"),e.abstract_exams=[],e.exams.forEach(function(t){var s=!0;t.semester!=e.user.semester&&(s=!1),"unbekannt"==t.date&&(s=!1),e.exams.length>10&&t.question_count<30&&(s=!1),t.answered_questions>0&&(s=!0),s&&(t.answered_questions>0?e.abstract_exams.unshift(t):e.abstract_exams.push(t))}),e.ready=1}),n.get("api/v1/tags/"+e.user.user_id).success(function(t){e.tags=t.tags,e.distinct_tags=[],e.tags.forEach(function(t){t.tags.split(",").forEach(function(t){-1==e.distinct_tags.indexOf(t)&&e.distinct_tags.push(t)})}),e.questions_by_tag={},e.distinct_tags.forEach(function(t){e.questions_by_tag[t]=[]}),e.distinct_tags.forEach(function(t){e.tags.forEach(function(s){s.tags.split(",").forEach(function(n){t==n&&e.questions_by_tag[t].push(s)})})})}),n.get("api/v1/comments/"+e.user.user_id).success(function(t){e.comments=t.comments,e.questions_by_comment={},e.comments.forEach(function(t){e.questions_by_comment[t.question]=[]}),e.comments.forEach(function(t){e.questions_by_comment[t.question].push(t)})}),e.learn_exam=function(e){var t=1;n.get("api/v1/exams/action/prepare/"+e+"/"+t).success(function(t){var n={list:t.list};n.exam_id=e,sessionStorage.currentQuestionList=angular.toJson(n),s.path("/question").search("id",n.list[0].question_id)})},e.learn_subjects=function(){var t={selection_subject_list:e.selection_subject_list,selection_number_questions:e.selection_number_questions};n.post("api/v1/learn/prepare",t).success(function(e){console.log(e);var t={list:e.list};t.selection_subject_list=e.selection_subject_list,sessionStorage.currentQuestionList=angular.toJson(t),s.path("/question").search("id",t.list[0].question_id)})},e.reset_results=function(t){var s=e.exams[t].exam_id;e.exams[t].answered_questions=0;var r={};n["delete"]("api/v1/results/"+e.user.user_id+"/"+s,r).success(function(e){console.log(e)})},e.reset_abstract_results=function(t){var s=e.abstract_exams[t].exam_id;e.abstract_exams[t].answered_questions=0;var r={};n["delete"]("api/v1/results/"+e.user.user_id+"/"+s,r).success(function(e){})},e.toggle_selection=function(t,s,n){var r=e.selection_subject_list,i=e.subject_list;if(n||(n=!1),Object.keys(r).indexOf(t)>-1)if(0==r[t].length)"all"==s&&delete r[t];else if(r[t].length>0)if("all"==s)n?delete r[t]:r[t]=i[t].slice(0);else{var o=r[t].indexOf(s);o>-1?(r[t].splice(o,1),0==r[t].length&&delete r[t]):r[t].push(s)}else"all"==s?r[t]=i[t].slice(0):r[t]=[s];else"all"==s?r[t]=i[t].slice(0):r[t]=[s]},e.search_question=function(){e.search_results=[];var t=e.question_search_query;if(e.question_field_message="",t.length){i.spin(document.getElementById("spinner"));{({query:t,subject:e.question_search_subject,semester:e.question_search_semester})}n.get("api/v1/questions/search/"+e.question_search_query+"/"+e.user.user_id).success(function(t){i.stop(),console.log(t),0==t.result.length?e.question_field_message="Nichts gefunden ;(":t.result.length>100?e.question_field_message="Zu Viel gefunden, geht es ein bisschen konkreter? ;(":e.search_results=t.result})}},e.exam_in_selection=function(t){return r.is_element_included(e.exams[t],e.exam_search)},e.exam_in_selection_count=function(){return r.count(e.exams,e.exam_search)},e.comment_in_selection=function(t){return r.is_element_included(e.comments[t],e.comment_search)},e.comment_in_selection_count=function(){return r.count(e.comments,e.comment_search)}}).controller("examCtrl",function(e,t,s,n,r,o,u){n.set_title_and_nav("Klausur | Crucio","Lernen"),e.user=angular.fromJson(sessionStorage.user),e.exam_id=s.id,e.questionList={exam_id:e.exam_id,list:[]},e.Math=window.Math,e.current_index=0,r.get("api/v1/exams/"+e.exam_id).success(function(t){e.exam=t;var s=e.exam.questions;for(i=0;i<s.length;i++){var n=s[i];e.questionList.list[i]=n}}),e.save_answer=function(t,s){e.questionList.list[t].given_result=String(s)},e.scroll_to_top=function(){$(window).scrollTop(0)},e.hand_exam=function(){console.log("questionList Abgabe"),console.log(e.questionList),sessionStorage.currentQuestionList=angular.toJson(e.questionList),o.path("/analysis").search("id",null)},e.open_image_model=function(t){console.log("Current Index",e.current_index);u.open({templateUrl:"imageModalContent.html",controller:"ModalInstanceCtrl",resolve:{image_url:function(){return t}}})}}).controller("questionCtrl",function(e,t,s,n,r,i){t.set_title_and_nav("Frage | Crucio","Lernen"),e.answerButtonClass="btn-primary",e.user=angular.fromJson(sessionStorage.user),e.questionList=angular.fromJson(sessionStorage.currentQuestionList),e.question_id=s.id,e.reset_session=s.reset_session,e.question_id||window.location.replace("/questions"),e.show_explanation=0,e.given_result=0,e.strike={},e.reset_session&&(e.questionList={},sessionStorage.currentQuestionList=angular.toJson(e.questionList)),e.questionList&&Object.keys(e.questionList).length&&(e.index=e.questionList.list.getIndexBy("question_id",e.question_id),e.length=e.questionList.list.length,e.show_answer=e.questionList.list[e.index].mark_answer,e.given_result=e.questionList.list[e.index].given_result,e.questionList.list[e.index].strike&&(e.strike=e.questionList.list[e.index].strike)),e.$watch("strike",function(t,s){e.questionList&&Object.keys(e.questionList).length&&(e.questionList.list[e.index].strike=t,sessionStorage.currentQuestionList=angular.toJson(e.questionList))},!0),n.get("api/v1/questions/"+e.question_id+"/user/"+e.user.user_id).success(function(t){e.question=t,e.question.question_image_url&&(e.question.question_image_url="/public/files/"+e.question.question_image_url);for(var s=0;s<e.question.comments.length;s++)e.question.comments[s].voting=parseInt(e.question.comments[s].voting)||0,e.question.comments[s].user_voting=parseInt(e.question.comments[s].user_voting)||0;var r=[];e.question.tags&&(r=e.question.tags.split(",")),$("#tagInput").tagsManager({prefilled:r,maxTags:5,replace:!0,output:null,tagsContainer:null,tagCloseIcon:"&times;",tagClass:"tm-tag-error",onlyTagList:!1,createHandler:function(t,s){var r={tags:s,question_id:e.question_id,user_id:e.user.user_id};n.post("api/v1/tags",r).success(function(e){})},removeHandler:function(t,s){var r={tags:s,question_id:e.question_id,user_id:e.user.user_id};n.post("api/v1/tags",r).success(function(e){})}}),e.given_result&&(console.log("question get given_result",e.given_result),e.check_answer(e.given_result)),e.show_answer&&e.mark_answer(e.given_result)}),e.show_solution=function(){var t=e.correct_answer(),s=t==e.given_result?1:0;0==t&&(s=-1),1==e.question.type&&(s=-1);var r={correct:s,question_id:e.question_id,user_id:e.user.user_id,given_result:e.given_result};n.post("api/v1/results",r).success(function(e){console.log(e)}),e.questionList&&Object.keys(e.questionList).length&&(e.questionList.list[e.index].mark_answer=1,sessionStorage.currentQuestionList=angular.toJson(e.questionList)),e.mark_answer(e.given_result)},e.save_answer=function(t){e.given_result=t,e.questionList&&Object.keys(e.questionList).length&&(e.questionList.list[e.index].given_result=t,sessionStorage.currentQuestionList=angular.toJson(e.questionList))},e.check_answer=function(t){e.checked_answer=t},e.correct_answer=function(){return e.question.correct_answer},e.mark_answer=function(t){e.mark_answer_free=!0;var s=e.question.type,n=e.correct_answer();s>1?(e.check_answer(t),t==n?(e.correctAnswer=t,e.answerButtonClass="btn-success"):(e.wrongAnswer=t,e.correctAnswer=n,e.answerButtonClass="btn-danger")):1==s&&(e.answerButtonClass="btn-info")},e.add_comment=function(){var t=new Date/1e3,s={comment:e.commentText,question_id:e.question_id,reply_to:0,username:e.user.username,date:t};n.post("api/v1/comments/"+e.user.user_id,s).success(function(t){s.voting=0,s.user_voting=0,s.comment_id=t.comment_id,e.question.comments.push(s),e.commentText=""})},e.delete_comment=function(t){var s=e.question.comments[t].comment_id;n["delete"]("api/v1/comments/"+s).success(function(e){}),e.question.comments.splice(t,1)},e.increase_user_voting=function(t,s){var r=1==t?1:t+1,i={user_voting:r};return n.post("api/v1/comments/"+s+"/user/"+e.user.user_id,i).success(function(e){}),r},e.decrease_user_voting=function(t,s){var r=-1==t?-1:t-1,i={user_voting:r};return n.post("api/v1/comments/"+s+"/user/"+e.user.user_id,i).success(function(e){}),r},e.open_image_model=function(){i.open({templateUrl:"imageModalContent.html",controller:"ModalInstanceCtrl",resolve:{image_url:function(){return e.question.question_image_url}}})}}).controller("ModalInstanceCtrl",function(e,t,s){e.image_url=s}).controller("analysisCtrl",function(e,t,s){t.set_title_and_nav("Analyse | Crucio","Lernen"),e.user=angular.fromJson(sessionStorage.user),e.questionList=angular.fromJson(sessionStorage.currentQuestionList);for(var n=0;n<e.questionList.list.length;n++){var r=e.questionList.list[n];if(!r.mark_answer){if(r.type>1&&r.given_result>0){var i=r.correct_answer==r.given_result?1:0;0==r.correct_answer&&(i=-1);var o={correct:i,question_id:r.question_id,user_id:e.user.user_id,given_answer:r.given_result};s.post("api/v1/results",o).success(function(e){})}r.mark_answer="analysis"}}e.workedQuestionList=e.questionList.list.getArrayByKey("given_result"),e.exam_id=e.questionList.exam_id,e.all_question_count=e.questionList.list.length,e.worked_question_count=e.workedQuestionList.length,e.correct_q_count=0,e.wrong_q_count=0,e.seen_q_count=0,e.solved_q_count=0,e.free_q_count=0,e.no_answer_q_count=0,e.get_random=function(e,t){if(e>t)return-1;if(e==t)return e;var s;do s=Math.random();while(1==s);return e+parseInt(s*(t-e+1))},e.random=e.get_random(0,1e3);for(var n=0;n<e.worked_question_count;n++){var r=e.workedQuestionList[n];r.correct_answer==r.given_result&&r.given_result>0&&r.correct_answer>0&&e.correct_q_count++,r.correct_answer!=r.given_result&&r.given_result>0&&r.correct_answer>0&&e.wrong_q_count++,r.given_result>0&&e.solved_q_count++,r.given_result>-2&&e.seen_q_count++,1==r.type&&e.free_q_count++,0==r.correct_answer&&1!=r.type&&e.no_answer_q_count++}e.exam_id&&s.get("api/v1/exams/"+e.exam_id).success(function(t){e.exam=t})}).controller("statisticsCtrl",function(e,t,s){t.set_title_and_nav("Statistik | Crucio","Lernen"),e.user=angular.fromJson(sessionStorage.user)}).filter("newline_to_br",function(e){return function(e){return void 0!==e?e.replace(/\n/g,"<br>"):void 0}}).directive("timeago",function(){var e={prefixAgo:"vor",prefixFromNow:"in",suffixAgo:"",suffixFromNow:"",seconds:"wenigen Sekunden",minute:"etwa einer Minute",minutes:"%d Minuten",hour:"etwa einer Stunde",hours:"%d Stunden",day:"etwa einem Tag",days:"%d Tagen",month:"etwa einem Monat",months:"%d Monaten",year:"etwa einem Jahr",years:"%d Jahren",wordSeparator:" ",numbers:[]};return{restrict:"A",link:function(t,s,n){n.$observe("timeago",function(){function t(e){var t={};return e&&"[object Function]"===t.toString.call(e)}function r(s,n){var r=t(s)?s(n,u):s,i=e.numbers&&e.numbers[n]||n;return r.replace(/%d/i,i)}var i=parseInt(n.timeago),o=(new Date).getTime(),u=Math.abs(o-i),a=u/1e3,c=a/60,l=c/60,_=l/24,m=_/365,d=e.prefixAgo,g=e.suffixAgo,f=45>a&&r(e.seconds,Math.round(a))||90>a&&r(e.minute,1)||45>c&&r(e.minutes,Math.round(c))||90>c&&r(e.hour,1)||24>l&&r(e.hours,Math.round(l))||42>l&&r(e.day,1)||30>_&&r(e.days,Math.round(_))||45>_&&r(e.month,1)||365>_&&r(e.months,Math.round(_/30))||1.5>m&&r(e.year,1)||r(e.years,Math.round(m)),p=e.wordSeparator;String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};var h=[d,f,g].join(p).trim();s.text(h)})}}}),angular.module("userModule",["ipCookie"]).controller("registerCtrl",function(e,t,s,n,r){e.user=angular.fromJson(sessionStorage.user),e.is_working=0,e.semester=1,e.course=1,e.$watch("username",function(t,s){t!=s&&(e.error_no_name=!r.non_empty(t),e.error_duplicate_name=0)},!0),e.$watch("email",function(t,s){t!=s&&(e.error_no_email=!r.email(t),e.error_duplicate_email=0)},!0),e.$watch("password",function(t,s){t!=s&&(e.error_no_password=!r.password(t))},!0),e.register=function(){var t=1;if(e.username||(t=0,e.error_no_name=1),r.email(e.email)||(t=0,e.error_no_email=1),r.password(e.password)||(t=0,e.error_no_password=1),e.password!=e.passwordc&&(t=0),t){e.is_working=1;var s={username:e.username,email:e.email.replace("@","(@)"),semester:e.semester,course:e.course,password:e.password};n.post("api/v1/users",s).success(function(t){e.is_working=0,"success"==t.status?$("#registerSucessModal").modal("show"):"error_username_taken"==t.status?e.error_duplicate_name=1:"error_email_taken"==t.status&&(e.error_duplicate_email=1);

})}}}).controller("activateCtrl",function(e,t,s,n,r){if(e.user=angular.fromJson(sessionStorage.user),e.token=r.search().token,e.token){var i={token:e.token};n.post("api/v1/users/action/activate",i).success(function(t){console.log(t),"error_unknown"==t.status?(e.success=0,e.error_no_token=0,e.error_unknown=1):"error_no_token"==t.status?(e.success=0,e.error_no_token=1,e.error_unknown=0):"success"==t.status&&(e.success=1,e.error_no_token=0,e.error_unknown=0)})}else e.success=0,e.error_no_token=1}).controller("forgotPasswordCtrl",function(e,t,s,n,r){if(e.user=angular.fromJson(sessionStorage.user),e.confirm=t.search().confirm,e.deny=t.search().deny,e.is_working=0,e.error_email=0,e.error_already_requested=0,e.confirm||e.deny||(e.reset=1),e.confirm){e.reset=0;var i={token:e.confirm};r.post("api/v1/users/password/confirm",i).success(function(t){e.status=t.status,$("#forgotConfirmModal").modal("show")})}if(e.deny){e.reset=0;var i={token:e.deny};r.post("api/v1/users/password/deny",i).success(function(t){e.status=t.status,$("#forgotDenyModal").modal("show")})}e.$watch("user.email",function(t,s){e.error_email=0,e.error_already_requested=0},!0),e.reset_password=function(){var t=!0;if(e.user?e.user.email||(t=!1,e.error_email=1):(t=!1,e.error_email=1),t){e.is_working=1;var s={email:e.user.email.replace("@","(@)")};r.post("api/v1/users/password/reset",s).success(function(t){e.is_working=0,t?"success"==t.status?(e.error_email=0,e.error_already_requested=0,$("#forgotSucessModal").modal("show")):"error_email"==t.status?e.error_email=1:"error_already_requested"==t.status&&(e.error_already_requested=1):e.error_email=1})}}}).controller("loginCtrl",function(e,t,s,n,r){e.user=angular.fromJson(sessionStorage.user),e.email="",e.remember_me=1,e.password="",e.login_error=!1,e.$watch("email",function(t,s){e.login_error=!1},!0),e.$watch("password",function(t,s){e.login_error=!1},!0),e.login=function(){-1==e.email.indexOf("@")&&(e.email+="@studserv.uni-leipzig.de");var t={email:e.email.replace("@","(@)"),remember_me:e.remember_me,password:e.password};n.post("api/v1/users/action/login",t).success(function(t){"success"==t.login?(1==e.remember_me&&r("CrucioUserDev",t.logged_in_user,{expires:21}),sessionStorage.user=angular.toJson(t.logged_in_user),window.location.replace("/questions")):e.login_error=!0})}}).controller("logoutCtrl",function(e,t,s){e.Page=t,e.user=angular.fromJson(sessionStorage.user),e.logout=function(){sessionStorage.user=angular.toJson({}),s.remove("CrucioUserDev"),window.location.replace(base_url)}}).controller("accountCtrl",function(e,t,s,n){t.set_title_and_nav("Account | Crucio","Name"),e.user=angular.fromJson(sessionStorage.user),e.user.semester=parseInt(e.user.semester),e.Validate=n,e.old_password="",e.wrong_password=!1,e.submit_button_title="Speichern",e.$watch("user.email",function(t,s){t!=s&&(e.submit_button_title="Speichern")},!0),e.$watch("old_password",function(t,s){t!=s&&(e.submit_button_title="Speichern",e.wrong_password=!1)},!0),e.$watch("new_password",function(t,s){t!=s&&(e.submit_button_title="Speichern")},!0),e.$watch("new_password_c",function(t,s){t!=s&&(e.submit_button_title="Speichern")},!0),e.save_user=function(){var t=!0;if(n.email(e.user.email)||(t=!1),(e.user.semester<1||e.user.semester>30)&&(t=!1),e.old_password.length>0&&(e.new_password.length<6&&(t=!1),e.new_password!=e.new_password_c&&(t=!1)),t){e.submit_button_title="Speichern...";var r={email:e.user.email.replace("@","(@)"),course_id:e.user.course_id,semester:e.user.semester,current_password:e.old_password,password:e.new_password};s.put("api/v1/users/"+e.user.user_id+"/account",r).success(function(t,s,n){console.log(t),"success"==t.status?(sessionStorage.user=angular.toJson(e.user),e.submit_button_title="Gespeichert"):(e.user=angular.fromJson(sessionStorage.user),e.user.semester=parseInt(e.user.semester),"error_incorrect_password"==t.status&&(e.wrong_password=!0),e.submit_button_title="Speichern nicht möglich...")})}else e.submit_button_title="Speichern nicht möglich..."}}).controller("settingsCtrl",function(e,t,s){t.set_title_and_nav("Einstellungen | Crucio","Name"),e.user=angular.fromJson(sessionStorage.user),$("#repetitionSlider").slider({value:e.user.repetitionValue}),e.submit_button_title="Speichern",e.update_user=function(){e.submit_button_title="Speichern...";var t=$("#repetitionSlider").slider("option","value");e.user.repetitionValue=t;var n={highlightExams:e.user.highlightExams,showComments:e.user.showComments,repetitionValue:t,useAnswers:e.user.useAnswers,useTags:e.user.useTags};s.put("api/v1/users/"+e.user.user_id+"/settings",n).success(function(t){"success"==t.status?(sessionStorage.user=angular.toJson(e.user),e.submit_button_title="Gespeichert"):(e.user=angular.fromJson(sessionStorage.user),e.submit_button_title="Speichern nicht möglich...")})},e.remove_all_results=function(){var t={};s["delete"]("api/v1/results/"+e.user.user_id,t).success(function(e){})}}).service("Validate",function(e){var t=Array();e.get("api/v1/whitelist").success(function(e,s,n,r){t=e.whitelist}),this.email=function(e){var s=/[\wäüöÄÜÖ]*@studserv\.uni-leipzig\.de$/;if(0==t.length)return!0;if(s.test(e))return!0;for(var n=0;n<t.length;n++)if(t[n].mail_address==e)return!0;return!1},this.password=function(e){return e?e.length<6?!1:!0:!1},this.non_empty=function(e){return 0==e.length?!1:!0}});